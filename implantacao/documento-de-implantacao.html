<!DOCTYPE HTML>
<html lang="pt" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Detalhes de Implantação | Portal de Serviços</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    
    <link rel="prev" href="../implantacao/index.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="11.1"
        data-chapter-title="Detalhes de Implantação"
        data-filepath="implantacao/documento-de-implantacao.md"
        data-basepath=".."
        data-revision="Thu Mar 31 2016 21:51:26 GMT+0000 (UTC)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introdução
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="sobre-este-documento/index.html">
            
                
                    <a href="../sobre-este-documento/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Sobre este documento
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="sobre-este-documento/convencoes-adotadas.html">
            
                
                    <a href="../sobre-este-documento/convencoes-adotadas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Convenções adotadas
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="sobre-este-documento/como-contribuir.html">
            
                
                    <a href="../sobre-este-documento/como-contribuir.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Como contribuir
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="principios/index.html">
            
                
                    <a href="../principios/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Princípios
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="sobre-o-projeto/index.html">
            
                
                    <a href="../sobre-o-projeto/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Sobre o projeto
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="sobre-o-projeto/equipe.html">
            
                
                    <a href="../sobre-o-projeto/equipe.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Equipe
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="sobre-o-projeto/contato.html">
            
                
                    <a href="../sobre-o-projeto/contato.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Contato
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="sobre-o-projeto/como-contribuir.html">
            
                
                    <a href="../sobre-o-projeto/como-contribuir.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Como contribuir
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="sobre-o-projeto/como-relatar-problemas.html">
            
                
                    <a href="../sobre-o-projeto/como-relatar-problemas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        Como relatar problemas
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="sobre-o-projeto/licenca.html">
            
                
                    <a href="../sobre-o-projeto/licenca.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Licença de uso
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="servicos/index.html">
            
                
                    <a href="../servicos/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Serviços
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="servicos/o-que-e-um-servico.html">
            
                
                    <a href="../servicos/o-que-e-um-servico.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        O que é um serviço?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="servicos/etapas-da-oferta.html">
            
                
                    <a href="../servicos/etapas-da-oferta.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Etapas da oferta de serviços
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="servicos/modelos-de-maturidade.html">
            
                
                    <a href="../servicos/modelos-de-maturidade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        Modelos de maturidade
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="servicos/criterios-para-escolha.html">
            
                
                    <a href="../servicos/criterios-para-escolha.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        Critérios para escolha
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="servicos/personas-identificadas.html">
            
                
                    <a href="../servicos/personas-identificadas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Personas identificadas
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.5.1" data-path="servicos/persona-aposentando.html">
            
                
                    <a href="../servicos/persona-aposentando.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.1.</b>
                        
                        Joana, Aposentanda
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5.2" data-path="servicos/persona-estudante.html">
            
                
                    <a href="../servicos/persona-estudante.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.2.</b>
                        
                        Eduardo, Estudante
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5.3" data-path="servicos/persona-exportador.html">
            
                
                    <a href="../servicos/persona-exportador.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.3.</b>
                        
                        Marcelo, Exportador
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="servicos/jornadas-identificadas.html">
            
                
                    <a href="../servicos/jornadas-identificadas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        Mapas de experiência
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.6.1" data-path="servicos/jornada-aposentando.html">
            
                
                    <a href="../servicos/jornada-aposentando.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.1.</b>
                        
                        Joana, Aposentando
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6.2" data-path="servicos/jornada-estudante.html">
            
                
                    <a href="../servicos/jornada-estudante.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.2.</b>
                        
                        Eduardo, Estudante
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6.3" data-path="servicos/jornada-exportador.html">
            
                
                    <a href="../servicos/jornada-exportador.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.3.</b>
                        
                        Marcelo, Exportador
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="modelo-de-explicitacao/index.html">
            
                
                    <a href="../modelo-de-explicitacao/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Modelo de explicitação de serviço
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="modelo-de-explicitacao/definicao-tecnica.html">
            
                
                    <a href="../modelo-de-explicitacao/definicao-tecnica.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Definição técnica
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="modelo-de-explicitacao/versoes.html">
            
                
                    <a href="../modelo-de-explicitacao/versoes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        Versões
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="modelo-de-explicitacao/estrutura-de-diretorios.html">
            
                
                    <a href="../modelo-de-explicitacao/estrutura-de-diretorios.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        Estrutura de diretórios
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="modelo-de-explicitacao/mer.html">
            
                
                    <a href="../modelo-de-explicitacao/mer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Diagrama de entidade relacionamento
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="modelo-de-explicitacao/migracoes-de-dados.html">
            
                
                    <a href="../modelo-de-explicitacao/migracoes-de-dados.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Migrações de dados
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="modelo-de-explicitacao/mapeamento-vcge.html">
            
                
                    <a href="../modelo-de-explicitacao/mapeamento-vcge.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        Mapeamento VCGE 1.0 para VCGE 2.0.3
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="metricas/index.html">
            
                
                    <a href="../metricas/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Métricas
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="metricas/kpis.html">
            
                
                    <a href="../metricas/kpis.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        KPIs
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="metricas/plataforma-de-performance.html">
            
                
                    <a href="../metricas/plataforma-de-performance.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        Plataforma de desempenho
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="metodologia-de-desenvolvimento/index.html">
            
                
                    <a href="../metodologia-de-desenvolvimento/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Metodologia de desenvolvimento
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="metodologia-de-desenvolvimento/hipoteses.html">
            
                
                    <a href="../metodologia-de-desenvolvimento/hipoteses.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Hipóteses
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="metodologia-de-desenvolvimento/metricas.html">
            
                
                    <a href="../metodologia-de-desenvolvimento/metricas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Métricas
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="metodologia-de-desenvolvimento/fluxo-de-trabalho.html">
            
                
                    <a href="../metodologia-de-desenvolvimento/fluxo-de-trabalho.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        Fluxo de trabalho
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="metodologia-de-desenvolvimento/kanban-e-iteracoes.html">
            
                
                    <a href="../metodologia-de-desenvolvimento/kanban-e-iteracoes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.4.</b>
                        
                        Kanban e Iterações
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="design/index.html">
            
                
                    <a href="../design/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Design
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="design/principios-de-design.html">
            
                
                    <a href="../design/principios-de-design.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Princípios de design
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="design/grade.html">
            
                
                    <a href="../design/grade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Grade
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="design/tipografia.html">
            
                
                    <a href="../design/tipografia.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Tipografia
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="design/cores.html">
            
                
                    <a href="../design/cores.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Cores
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="design/imagens-e-icones.html">
            
                
                    <a href="../design/imagens-e-icones.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Imagens e ícones
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="design/testes-de-usabilidade.html">
            
                
                    <a href="../design/testes-de-usabilidade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        Testes de Usabilidade
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.6.1" data-path="design/roteiro-teste-de-usabilidade.html">
            
                
                    <a href="../design/roteiro-teste-de-usabilidade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.1.</b>
                        
                        Roteiro de Teste de Usabilidade
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="conteudo/index.html">
            
                
                    <a href="../conteudo/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Conteúdo
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="conteudo/dicas-bom-conteudo.html">
            
                
                    <a href="../conteudo/dicas-bom-conteudo.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Dicas para um bom conteúdo
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="conteudo/conteudo-relevante.html">
            
                
                    <a href="../conteudo/conteudo-relevante.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Conteúdo relevante
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="conteudo/conteudo-acessivel.html">
            
                
                    <a href="../conteudo/conteudo-acessivel.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.3.</b>
                        
                        Conteúdo acessível
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="conteudo/titulos.html">
            
                
                    <a href="../conteudo/titulos.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.4.</b>
                        
                        Títulos
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="desenvolvimento/index.html">
            
                
                    <a href="../desenvolvimento/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Desenvolvimento
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1" data-path="desenvolvimento/arquitetura.html">
            
                
                    <a href="../desenvolvimento/arquitetura.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                        Arquitetura
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="desenvolvimento/ferramentas-utilizadas.html">
            
                
                    <a href="../desenvolvimento/ferramentas-utilizadas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.2.</b>
                        
                        Ferramentas utilizadas
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="desenvolvimento/infraestrutura.html">
            
                
                    <a href="../desenvolvimento/infraestrutura.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.3.</b>
                        
                        Infraestrutura
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="desenvolvimento/dados-criptografados.html">
            
                
                    <a href="../desenvolvimento/dados-criptografados.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.4.</b>
                        
                        Dados Criptografados
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.5" data-path="desenvolvimento/implantacao-e-execucao.html">
            
                
                    <a href="../desenvolvimento/implantacao-e-execucao.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.5.</b>
                        
                        Implantação e execução
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.5.1" data-path="desenvolvimento/deploy-local.html">
            
                
                    <a href="../desenvolvimento/deploy-local.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.5.1.</b>
                        
                        Desenvolvimento local
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.5.2" data-path="desenvolvimento/persistencia-acesso-permissoes.html">
            
                
                    <a href="../desenvolvimento/persistencia-acesso-permissoes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.5.2.</b>
                        
                        Persistencia de Acesso e Permissões
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10.6" data-path="desenvolvimento/configuracao.html">
            
                
                    <a href="../desenvolvimento/configuracao.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.6.</b>
                        
                        Configuração
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.7" data-path="desenvolvimento/testes.html">
            
                
                    <a href="../desenvolvimento/testes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.7.</b>
                        
                        Testes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.8" data-path="desenvolvimento/entrega-continua.html">
            
                
                    <a href="../desenvolvimento/entrega-continua.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.8.</b>
                        
                        Entrega Contínua
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.8.1" data-path="desenvolvimento/repositorio-yum.html">
            
                
                    <a href="../desenvolvimento/repositorio-yum.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.8.1.</b>
                        
                        Repositório Yum
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10.9" data-path="desenvolvimento/elasticsearch.html">
            
                
                    <a href="../desenvolvimento/elasticsearch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.9.</b>
                        
                        ElasticSearch
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10" data-path="desenvolvimento/requisitos-transversais.html">
            
                
                    <a href="../desenvolvimento/requisitos-transversais.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.</b>
                        
                        Requisitos Transversais
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.10.1" data-path="desenvolvimento/acessibilidade.html">
            
                
                    <a href="../desenvolvimento/acessibilidade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.1.</b>
                        
                        Acessibilidade
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.2" data-path="desenvolvimento/auditabilidade.html">
            
                
                    <a href="../desenvolvimento/auditabilidade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.2.</b>
                        
                        Auditabilidade
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.3" data-path="desenvolvimento/backups.html">
            
                
                    <a href="../desenvolvimento/backups.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.3.</b>
                        
                        Backups
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.4" data-path="desenvolvimento/compatibilidade-de-plataformas.html">
            
                
                    <a href="../desenvolvimento/compatibilidade-de-plataformas.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.4.</b>
                        
                        Compatibilidade de plataformas
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.5" data-path="desenvolvimento/dependencias-de-terceiros.html">
            
                
                    <a href="../desenvolvimento/dependencias-de-terceiros.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.5.</b>
                        
                        Dependências de terceiros
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.6" data-path="desenvolvimento/disponibilidade.html">
            
                
                    <a href="../desenvolvimento/disponibilidade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.6.</b>
                        
                        Disponibilidade
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.7" data-path="desenvolvimento/documentacao.html">
            
                
                    <a href="../desenvolvimento/documentacao.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.7.</b>
                        
                        Documentação
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.8" data-path="desenvolvimento/escalabilidade.html">
            
                
                    <a href="../desenvolvimento/escalabilidade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.8.</b>
                        
                        Escalabilidade
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.9" data-path="desenvolvimento/monitoramento.html">
            
                
                    <a href="../desenvolvimento/monitoramento.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.9.</b>
                        
                        Monitoramento
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.10" data-path="desenvolvimento/performance.html">
            
                
                    <a href="../desenvolvimento/performance.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.10.</b>
                        
                        Performance
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.11" data-path="desenvolvimento/privacidade.html">
            
                
                    <a href="../desenvolvimento/privacidade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.11.</b>
                        
                        Privacidade
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.12" data-path="desenvolvimento/seguranca.html">
            
                
                    <a href="../desenvolvimento/seguranca.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.12.</b>
                        
                        Segurança
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10.10.13" data-path="desenvolvimento/usabilidade.html">
            
                
                    <a href="../desenvolvimento/usabilidade.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.10.13.</b>
                        
                        Usabilidade
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11" data-path="implantacao/index.html">
            
                
                    <a href="../implantacao/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Implantação
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="11.1" data-path="implantacao/documento-de-implantacao.html">
            
                
                    <a href="../implantacao/documento-de-implantacao.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.1.</b>
                        
                        Detalhes de Implantação
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Publicado com GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Portal de Serviços</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="documento-de-implanta&#xE7;&#xE3;o">Documento de Implanta&#xE7;&#xE3;o</h1>
<p>Neste documento est&#xE3;o todas as informa&#xE7;&#xF5;es necess&#xE1;rias &#xE0; implanta&#xE7;&#xE3;o e opera&#xE7;&#xE3;o do Portal de Servi&#xE7;os e Editor de Servi&#xE7;os em ambientes de, ou similares a, produ&#xE7;&#xE3;o.</p>
<h1 id="infraestrutura">Infraestrutura</h1>
<p><img src="../desenvolvimento/ambiente-docker.png" alt="Diagrama da rede em ambiente similar a produ&#xE7;&#xE3;o"></p>
<h2 id="ambientes-docker">Ambientes Docker</h2>
<p>Estes ambientes cont&#xE9;m uma m&#xE1;quina virtual com as seguintes aplica&#xE7;&#xF5;es Docker:</p>
<ul>
<li>Balanceador de carga (haproxy)</li>
<li>Portal de Servi&#xE7;os 1</li>
<li>Portal de Servi&#xE7;os 2</li>
<li>Editor de Servi&#xE7;os 1</li>
<li>Editor de Servi&#xE7;os 2</li>
<li>ElasticSearch 1</li>
<li>ElasticSearch 2</li>
<li>cAdvisor</li>
<li>Logspout</li>
<li>Logstash</li>
</ul>
<p>Estas est&#xE3;o definidas na configura&#xE7;&#xE3;o, em formato <a href="http://www.docker.com/compose" target="_blank">Docker-Compose</a>, do <a href="https://github.com/servicosgovbr/docker" target="_blank">reposit&#xF3;rio relacionado</a>.</p>
<h2 id="portas-e-firewalls">Portas e firewalls</h2>
<p>Por padr&#xE3;o, o balanceador &#xE9; o &#xFA;nico cont&#xEA;iner que exp&#xF5;e portas abertas para o host. Todo o tr&#xE1;fego deve ser direcionado a estas portas, e o balanceador lida com a distribui&#xE7;&#xE3;o interna. S&#xE3;o elas:</p>
<ul>
<li>80/tcp (HTTP): Tr&#xE1;fego para o Portal de Servi&#xE7;os (<code>/*</code>) e Editor de Servi&#xE7;os (<code>/editar/*</code>)</li>
<li>8080/tcp (HTTP): Tr&#xE1;fego para o cAdvisor (<code>/*</code>) e estat&#xED;sticas do HAProxy (<code>/lb-stats</code>)</li>
<li>5601/tcp (HTTP): Tr&#xE1;fego para o Kibana (<code>/*</code>)</li>
</ul>
<h3 id="portas-internas">Portas internas</h3>
<p>Estas s&#xE3;o as portas utilizadas internamente para comunica&#xE7;&#xE3;o entre cont&#xEA;ineres:</p>
<table>
<thead>
<tr>
<th>Origem</th>
<th>Destino</th>
<th>Portas</th>
<th>Notas</th>
</tr>
</thead>
<tbody>
<tr>
<td>Balanceador</td>
<td>Portal de Servi&#xE7;os</td>
<td>8080/tcp</td>
<td></td>
</tr>
<tr>
<td>Balanceador</td>
<td>Editor de Servi&#xE7;os</td>
<td>8090/tcp</td>
<td></td>
</tr>
<tr>
<td>Balanceador</td>
<td>cAdvisor</td>
<td>8080/tcp</td>
<td></td>
</tr>
<tr>
<td>Balanceador</td>
<td>Kibana</td>
<td>5601/tcp</td>
<td></td>
</tr>
<tr>
<td>Balanceador</td>
<td>ElasticSearch</td>
<td>9200/tcp e 9300/tcp</td>
<td>Usadas apenas para monitoria</td>
</tr>
<tr>
<td>Balanceador</td>
<td>Logstash</td>
<td>5000/tcp</td>
<td>Usada apenas para monitoria</td>
</tr>
<tr>
<td>Portal de Servi&#xE7;os</td>
<td>ElasticSearch</td>
<td>9300/tcp</td>
<td></td>
</tr>
<tr>
<td>Logspout</td>
<td>Logstash</td>
<td>5000/udp</td>
<td></td>
</tr>
<tr>
<td>Logstash</td>
<td>ElasticSearch</td>
<td>9300/tcp</td>
<td></td>
</tr>
<tr>
<td>Kibana</td>
<td>ElasticSearch</td>
<td>9200/tcp</td>
<td>Usa apenas o ElasticSearch 1</td>
</tr>
</tbody>
</table>
<h3 id="volumes-externos">Volumes externos</h3>
<p>Os seguintes arquivos e diret&#xF3;rios s&#xE3;o disponibilizados da m&#xE1;quina host para os cont&#xEA;ineres:</p>
<table>
<thead>
<tr>
<th>Cont&#xEA;iner</th>
<th>Volume</th>
<th>Backup?</th>
<th>Notas</th>
</tr>
</thead>
<tbody>
<tr>
<td>Editor de Servi&#xE7;os 1</td>
<td>/root/.ssh</td>
<td>Sim</td>
<td>Chave SSH para publica&#xE7;&#xE3;o no Github, somente leitura</td>
</tr>
<tr>
<td>Editor de Servi&#xE7;os 2</td>
<td>/root/.ssh</td>
<td>Sim</td>
<td>Chave SSH para publica&#xE7;&#xE3;o no Github, somente leitura</td>
</tr>
<tr>
<td>cAdvisor</td>
<td>/var/run</td>
<td>N&#xE3;o</td>
<td></td>
</tr>
<tr>
<td>cAdvisor</td>
<td>/</td>
<td>N&#xE3;o</td>
<td>Somente leitura</td>
</tr>
<tr>
<td>cAdvisor</td>
<td>/sys</td>
<td>N&#xE3;o</td>
<td>Somente leitura</td>
</tr>
<tr>
<td>cAdvisor</td>
<td>/var/lib/docker/</td>
<td>N&#xE3;o</td>
<td>Somente leitura</td>
</tr>
<tr>
<td>Logspout</td>
<td>/var/run/docker.sock</td>
<td>N&#xE3;o</td>
<td></td>
</tr>
<tr>
<td>ElasticSearch 1</td>
<td>/usr/share/elasticsearch/es1/data</td>
<td>Sim</td>
<td></td>
</tr>
<tr>
<td>ElasticSearch 2</td>
<td>/usr/share/elasticsearch/es2/data</td>
<td>Sim</td>
<td></td>
</tr>
<tr>
<td>Logstash</td>
<td>/root/docker/logstash</td>
<td>N&#xE3;o</td>
<td>Somente leitura</td>
</tr>
</tbody>
</table>
<h2 id="configura&#xE7;&#xE3;o">Configura&#xE7;&#xE3;o</h2>
<p>Tanto o Portal quanto o Editor de Servi&#xE7;os utilizam vari&#xE1;veis de ambiente para configura&#xE7;&#xE3;o. Todas elas t&#xEA;m valores padr&#xE3;o, e algumas s&#xE3;o redefinidas na configura&#xE7;&#xE3;o dos cont&#xEA;iners usando o <a href="http://www.docker.com/compose" target="_blank">Docker-Compose</a> (mais especificamente, atrav&#xE9;s da diretiva <code>environment</code> dos arquivos <code>docker-compose.yml</code> do <a href="https://github.com/servicosgovbr/docker/blob/master/portal-de-servicos/docker-compose.yml" target="_blank">Portal</a> e do <a href="https://github.com/servicosgovbr/docker/blob/master/editor-de-servicos/docker-compose.yml" target="_blank">Editor</a>).</p>
<p>Os arquivos que listam as configura&#xE7;&#xF5;es padr&#xE3;o s&#xE3;o:</p>
<ul>
<li>Portal de Servi&#xE7;os: <a href="https://github.com/servicosgovbr/portal-de-servicos/blob/master/scripts/portal-de-servicos.default.config" target="_blank"><code>scripts/portal-de-servicos.default.config</code></a></li>
<li>Editor de Servi&#xE7;os: <a href="https://github.com/servicosgovbr/editor-de-servicos/blob/master/scripts/editor-de-servicos.default.config" target="_blank"><code>scripts/editor-de-servicos.default.config</code></a></li>
</ul>
<h2 id="acessos-e-conex&#xF5;es">Acessos e Conex&#xF5;es</h2>
<p>Atrav&#xE9;s de acordos t&#xE9;cnicos e conversas com os respons&#xE1;veis pela infraestrutura do Minist&#xE9;rio do Planejamento, as seguintes regras acessos de <strong><em>firewall</em></strong> foram definidas como essenciais para garantir a interoperabilidade do Portal de Servi&#xE7;os: </p>
<p><strong>Acessos que devem estar liberados na entrada das m&#xE1;quinas de Desenvolvimento e Produ&#xE7;&#xE3;o</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>Desenvolvimento (189.9.150.163)</th>
<th>Produ&#xE7;&#xE3;o (189.9.151.72)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Snap (54.186.9.43)</td>
<td>22, 80, 443</td>
<td>NA</td>
</tr>
<tr>
<td>Internet</td>
<td>80, 443</td>
<td>80, 443</td>
</tr>
<tr>
<td>Minist&#xE9;rio do Planejamento</td>
<td>22, 80, 443, 8080, 5601</td>
<td>80, 443, 8080, 5601</td>
</tr>
</tbody>
</table>
<p><strong>Acessos que devem estar liberados na sa&#xED;da das m&#xE1;quinas de Desenvolvimento e Produ&#xE7;&#xE3;o</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>Servidor Git (192.30.252.0/22)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Desenvolvimento (189.9.150.163)</td>
<td>22, 80, 443</td>
</tr>
<tr>
<td>Produ&#xE7;&#xE3;o (189.9.151.72)</td>
<td>22, 80, 443</td>
</tr>
</tbody>
</table>
<h2 id="checklist-de-implanta&#xE7;&#xE3;o">Checklist de Implanta&#xE7;&#xE3;o</h2>
<h3 id="primeira-instala&#xE7;&#xE3;o">Primeira instala&#xE7;&#xE3;o</h3>
<p>Todos os comandos a seguir devem ser executados como super-usu&#xE1;rio (root), e presumem uma m&#xE1;quina [CentOS] 7 64bit, sem nenhuma configura&#xE7;&#xE3;o adicional efetuada. As vers&#xF5;es do CentOS utilizadas para homologa&#xE7;&#xE3;o foram: 7.1 e 7.2. Al&#xE9;m disso, ser <strong>64bit</strong> &#xE9; realmente necess&#xE1;rio, pois &#xE9; a &#xFA;nica plataforma suportada pelo Docker na arquitetura X86.</p>
<h3 id="configura&#xE7;&#xE3;o-inicial">Configura&#xE7;&#xE3;o Inicial</h3>
<ul>
<li>Verifique que o kernel instalado &#xE9;, no m&#xED;nimo, 3.10, rodando em modo x64:</li>
</ul>
<pre><code class="lang-bash">uname -r
<span class="hljs-number">3.10</span>.<span class="hljs-number">0</span>-<span class="hljs-number">229</span>.el7.x86_64
</code></pre>
<p>Caso contr&#xE1;rio, &#xE9; preciso realizar as atualiza&#xE7;&#xF5;es necess&#xE1;rias antes de continuar.</p>
<ul>
<li>Desabilite o <a href="https://wiki.centos.org/HowTos/SELinux" target="_blank">SELinux</a> temporariamente:</li>
</ul>
<pre><code class="lang-bash">setenforce <span class="hljs-number">0</span>
</code></pre>
<ul>
<li>Instale o <a href="http://www.docker.com" target="_blank">Docker</a>:</li>
</ul>
<pre><code class="lang-bash">curl <span class="hljs-operator">-s</span>SL https://get.docker.com | sh
</code></pre>
<ul>
<li>Crie os volumes de dados e metadados do Docker:</li>
</ul>
<pre><code class="lang-bash">pvcreate /dev/sdb1 
vgcreate vg-docker /dev/sdb1 
lvcreate -L <span class="hljs-number">7</span>G -n data vg-docker
lvcreate -L <span class="hljs-number">2</span>G -n metadata vg-docker
</code></pre>
<ul>
<li>Inicie o servi&#xE7;o do <a href="http://www.docker.com" target="_blank">Docker</a>:</li>
</ul>
<pre><code class="lang-bash">systemctl start docker
</code></pre>
<ul>
<li>Verifique que o servi&#xE7;o do <a href="http://www.docker.com" target="_blank">Docker</a> inicializou corretamente:</li>
</ul>
<pre><code class="lang-bash">docker info
</code></pre>
<p>O comando acima deve produzir sa&#xED;da contendo texto similar ao seguinte:</p>
<pre><code>Containers: 0
 Running: 0
 Paused: 0
 Stopped: 0
Images: 0
Server Version: 1.10.2
Storage Driver: devicemapper
 Pool Name: docker-253:1-124711-pool
 Pool Blocksize: 65.54 kB
 Base Device Size: 10.74 GB
 Backing Filesystem: xfs
 Data file: /dev/vg-docker/data
 Metadata file: /dev/vg-docker/metadata
 Data Space Used: 2.989 GB
 Data Space Total: 8.59 GB
 Data Space Available: 5.601 GB
 Metadata Space Used: 7.025 MB
 Metadata Space Total: 1.074 GB
 Metadata Space Available: 1.067 GB
 Udev Sync Supported: true
 Deferred Removal Enabled: false
 Deferred Deletion Enabled: false
 Deferred Deleted Device Count: 0
 Library Version: 1.02.107-RHEL7 (2015-12-01)
</code></pre><p>(note os nomes do <code>Data file</code> e <code>Metadata file</code>, que s&#xE3;o os volumes LVM criados no passo anterior.)</p>
<ul>
<li>Verifique que o <a href="http://www.docker.com" target="_blank">Docker</a> consegue baixar e instanciar cont&#xEA;ineres:</li>
</ul>
<pre><code class="lang-bash">docker run alpine <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ol&#xE1;&quot;</span>
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>Unable to find image &apos;alpine:latest&apos; locally
latest: Pulling from library/alpine
31f630c65071: Already exists
library/alpine:latest: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.
Digest: sha256:c471fce1d08618adf4c6c0d72c047b9f3d5ef82cae0ca9a157ce1c800d42722f
Status: Downloaded newer image for alpine:latest
ol&#xE1;
</code></pre><ul>
<li>Configure o servi&#xE7;o do <a href="http://www.docker.com" target="_blank">Docker</a> para inicializar durante o boot:</li>
</ul>
<pre><code class="lang-bash">chkconfig docker on
</code></pre>
<ul>
<li>Instale o <a href="http://www.docker.com/compose" target="_blank">Docker-Compose</a>:</li>
</ul>
<pre><code class="lang-bash">curl -L https://github.com/docker/compose/releases/download/<span class="hljs-number">1.4</span>.<span class="hljs-number">0</span>/docker-compose-`uname <span class="hljs-operator">-s</span>`-`uname -m` &gt; /usr/bin/docker-compose
chmod +x /usr/bin/docker-compose
</code></pre>
<ul>
<li>Verifique a instala&#xE7;&#xE3;o do <a href="http://www.docker.com/compose" target="_blank">Docker-Compose</a></li>
</ul>
<pre><code class="lang-bash">docker-compose version
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>docker-compose version 1.4.0, build 4d72027
docker-py version: 1.7.2
CPython version: 2.7.11
OpenSSL version: OpenSSL 1.0.2g  1 Mar 2016
</code></pre><ul>
<li>Instale o <a href="http://git-scm.org" target="_blank">Git</a>:</li>
</ul>
<pre><code class="lang-bash">yum install -y git
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>...

Installed:
  git.x86_64 0:1.8.3.1-4.el7

...
</code></pre><h3 id="clone-reposit&#xF3;rio-docker">Clone Reposit&#xF3;rio Docker</h3>
<ul>
<li>Clone o reposit&#xF3;rio <a href="https://github.com/servicosgovbr/docker" target="_blank">servicosgovbr/docker</a> no diret&#xF3;rio <code>/root</code>:</li>
</ul>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> /root
git <span class="hljs-built_in">clone</span> https://github.com/servicosgovbr/docker
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>Cloning into &apos;docker&apos;...
remote: Counting objects: 152, done.
remote: Compressing objects: 100% (61/61), done.
remote: Total 152 (delta 34), reused 0 (delta 0), pack-reused 85
Receiving objects: 100% (152/152), 18.87 KiB | 0 bytes/s, done.
Resolving deltas: 100% (77/77), done.
</code></pre><h3 id="redirecionando-de-tr&#xE1;fego">Redirecionando de tr&#xE1;fego</h3>
<p>&#xC9; poss&#xED;vel que o ambiente em que a instala&#xE7;&#xE3;o esteja sendo realizada possua restri&#xE7;&#xF5;es de firewall. Algumas das restri&#xE7;&#xF5;es que enfrentamos anteriormente, em ambiente do governo, foram restri&#xE7;&#xF5;es de tr&#xE1;fego na porta 22 para o GitHub. Nesse caso, sugere-se uma solu&#xE7;&#xE3;o de contorno. Essa solu&#xE7;&#xE3;o de contorno ir&#xE1; redirecionar todo o tr&#xE1;fego da porta 22 para a porta 443. Considera-se que a porta 443 n&#xE3;o possua restri&#xE7;&#xF5;es, e que esse tipo de redirecionamento seja permitido na infra-estrutura em que est&#xE1; sendo realizada a instala&#xE7;&#xE3;o.</p>
<p>Para isso, a seguinte altera&#xE7;&#xE3;o &#xE9; necess&#xE1;ria no arquivo <code>/root/.ssh/config</code>:</p>
<pre><code>Host github.com
  Hostname ssh.github.com
  Port 443
</code></pre><p>O c&#xF3;digo acima deve ser adicionado no arquivo <code>config</code>. Caso o arquivo n&#xE3;o exista, sugere-se a cria&#xE7;&#xE3;o do arquivo. Maiores informa&#xE7;&#xF5;es podem ser encontradas na <a href="https://help.github.com/articles/using-ssh-over-the-https-port/" target="_blank">documenta&#xE7;&#xE3;o oficial</a> do Github.</p>
<p>Para testar a conex&#xE3;o e aceitar o certificado de acesso, utilize o seguinte comando:</p>
<pre><code>ssh -T git@github.com
</code></pre><p>O resultado esperado &#xE9; a seguinte mensagem:</p>
<pre><code>You&apos;ve successfully authenticated, but GitHub does not provide shell access.
</code></pre><h3 id="chaves-ssh">Chaves SSH</h3>
<p>Para o correto funcionamento do Editor de Servi&#xE7;os, os seguintes passos s&#xE3;o necess&#xE1;rios:</p>
<ol>
<li>Criar uma nova chave SSH, conforme p&#xE1;gina de <a href="https://help.github.com/articles/generating-ssh-keys/" target="_blank">SSH Keys</a> do GitHub. A chave criada n&#xE3;o deve conter nenhum tipo de passphrase. Sugere-se que essa chave seja associada a um e-mail v&#xE1;lido de uma conta existente no GitHub e que o usu&#xE1;rio esteja autorizado a acessar os projetos da <a href="https://github.com/servicosgovbr" target="_blank">organiza&#xE7;&#xE3;o do servicos.gov.br</a>.</li>
<li>Colocar essa chave na pasta <code>/root/.ssh</code>.</li>
<li>Importar chave com permiss&#xE3;o de leitura e escrita no reposit&#xF3;rio de <code>cartas-de-servicos</code>. Detalhes sobre esse processo podem ser encontrados na nota abaixo, ou na p&#xE1;gina de <a href="https://developer.github.com/guides/managing-deploy-keys/" target="_blank">Deploy Keys</a> do GitHub. A chave importada deve ser utilizada exclusivamente no reposit&#xF3;rio de cartas. Caso a chave for utilizada em algum outro lugar, uma mensagem de erro ser&#xE1; exibida.</li>
</ol>
<p><strong>Notas:</strong></p>
<p>&#xC9; importante que o usu&#xE1;rio que ir&#xE1; realizar a opera&#xE7;&#xE3;o de importa&#xE7;&#xE3;o tenha as devidas permiss&#xF5;es no reposit&#xF3;rio <code>cartas-de-servico</code> do GitHub. Caso o usu&#xE1;rio n&#xE3;o tenha permiss&#xF5;es suficientes, &#xE9; necess&#xE1;rio contactar os administradores do reposit&#xF3;rio.</p>
<p>Caso, n&#xE3;o for poss&#xED;vel encontrar o reposit&#xF3;rio que a chave deve ser importada, acessar o seguinte <a href="https://github.com/servicosgovbr/cartas-de-servico" target="_blank">reposit&#xF3;rio</a> no GitHub. Estando na p&#xE1;gina do reposit&#xF3;rio, os seguintes passos devem ser realizados:</p>
<ol>
<li>Clicar em &quot;Settings&quot;</li>
<li>No lado direto inferior da interface, clicar em &quot;Deploy Keys&quot;</li>
<li>Clicar em &quot;Add Deploy Key&quot;</li>
<li>Criar um nome para a nova chave, no campo &quot;Title&quot;</li>
<li>Inserir o conte&#xFA;do da chave p&#xFA;blica criada anteriormente no campo &quot;Key&quot;</li>
<li>Selecionar a op&#xE7;&#xE3;o &quot;Allow write access&quot;</li>
<li>Clicar no bot&#xE3;o &quot;Add Key&quot; para adicionar a chave</li>
</ol>
<p>Para visualizar as chaves de deploy voc&#xEA; pode acessar o seguinte <a href="https://github.com/servicosgovbr/cartas-de-servico/settings/keys" target="_blank">link</a>.</p>
<h3 id="certificado-digital-ssl">Certificado Digital SSL</h3>
<p>O Editor de Servi&#xE7;os utiliza um certificado digital para aumentar a seguran&#xE7;a da comunica&#xE7;&#xE3;o entre usu&#xE1;rio e a aplica&#xE7;&#xE3;o. Deve ser utilizado o certificado auto assinado enviado por email, ou um do mesmo padr&#xE3;o criado a partir dos passos a seguir.</p>
<h4 id="gera&#xE7;&#xE3;o-de-um-certificado-digital">Gera&#xE7;&#xE3;o de um certificado digital</h4>
<p>Para gerar esse certificado digital corretamente &#xE9; necess&#xE1;rio criar um arquivo <code>.pem</code>, obtido a partir do certificado original. Para gerar esse arquivo <code>.pem</code>, os seguintes passos s&#xE3;o necess&#xE1;rios:</p>
<ul>
<li>Copiar arquivos disponibilizados do certificado digital para <code>/root/docker/balanceador/ssl/private</code></li>
<li>Remover a senha da chave privada: <code>openssl rsa -in servicos.gov.br.key -out servicos.gov.br.key.out</code></li>
<li>Gerar arquivo .cer: <code>openssl pkcs7 -print_certs -in SERVICOSGOVBR.p7b -out SERVICOSGOVBR.cer</code></li>
<li>Converter o certificado de pkcs7 para pkcs12, de forma a colocar a chave privada e o certificado no mesmo arquivo: <code>openssl pkcs12 -export -in SERVICOSGOVBR.cer -inkey servicos.gov.br.key.out -out SERVICOSGOVBR.pfx</code></li>
<li>Converter de pkcs12 para .pem, formato que o balanceador sabe trabalhar: <code>openssl pkcs12 -in SERVICOSGOVBR.pfx -out SERVICOSGOVBR.pem -nodes</code></li>
</ul>
<h3 id="utilizando-vari&#xE1;veis-de-ambiente">Utilizando vari&#xE1;veis de ambiente</h3>
<p>Antes de inicializar os cont&#xEA;ineres, &#xE9; necess&#xE1;rio que as seguintes vari&#xE1;veis de ambiente sejam configuradas para a instala&#xE7;&#xE3;o inicial:</p>
<ul>
<li><code>export EDS_CARTAS_REPOSITORIO=&apos;git@github.com:servicosgovbr/cartas-de-servico.git&apos;</code></li>
<li><code>export PDS_CARTAS_REPOSITORIO=&apos;https://github.com/servicosgovbr/cartas-de-servico.git&apos;</code></li>
</ul>
<p>Para utiliza&#xE7;&#xE3;o do PIWIK, &#xE9; necess&#xE1;rio antes da inicializa&#xE7;&#xE3;o dos cont&#xEA;iners configurar as seguintes vari&#xE1;veis de ambiente (os valores abaixo s&#xE3;o referentes ao PIWIK do portal de servi&#xE7;os no Minist&#xE9;rio do Planejamento):</p>
<ul>
<li><code>export PDS_PIWIK_ENABLED=&apos;true&apos;</code></li>
<li><code>export PDS_PIWIK_SITE=2</code></li>
<li><code>export PDS_PIWIK_URL=&quot;https://estatisticas.presidencia.gov.br/&quot;</code></li>
<li><code>export PDS_PIWIK_TOKEN=&apos;&apos;</code> (Para acessar o TOKEN do portal instalado no Minist&#xE9;rio do Planejamento entrar em contato com a Coordena&#xE7;&#xE3;o-Geral de Dados e Servi&#xE7;os P&#xFA;blicos Digitais. Nos outros casos deve ser utilizado PIWIK e TOKEN pr&#xF3;prios)</li>
</ul>
<p>Para habilitar rob&#xF4;s de busca, configurar a seguinte vari&#xE1;vel de ambiente:</p>
<ul>
<li><code>export FLAGS_PERMITIR_ROBOS=&apos;true&apos;</code></li>
</ul>
<p>Ap&#xF3;s executar esses comandos, precisamos persistir os valores das v&#xE1;riaveis. Devemos criar um arquivo em <code>/etc/profile.d/repositorios.sh</code> com o seguinte conte&#xFA;do:</p>
<pre><code>export EDS_CARTAS_REPOSITORIO=&apos;git@github.com:servicosgovbr/cartas-de-servico.git&apos;
export PDS_CARTAS_REPOSITORIO=&apos;https://github.com/servicosgovbr/cartas-de-servico.git&apos;
export PDS_PIWIK_ENABLED=&apos;true&apos;
export PDS_PIWIK_SITE=2
export PDS_PIWIK_URL=&quot;https://estatisticas.presidencia.gov.br/&quot;
export PDS_PIWIK_TOKEN=&apos;&apos; 
export FLAGS_PERMITIR_ROBOS=&apos;true&apos;
</code></pre><p>Ressaltamos que para acessar o TOKEN entrar em contato com a Coordena&#xE7;&#xE3;o-Geral de Dados e Servi&#xE7;os P&#xFA;blicos Digitais.</p>
<h3 id="construindo-os-cont&#xEA;ineres">Construindo os Cont&#xEA;ineres</h3>
<p>Construa e rode os cont&#xEA;ineres:</p>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> /root/docker
./build-all <span class="hljs-comment"># caso prefira baixar as imagens do docker hub, omita este passo</span>
docker-compose up <span class="hljs-operator">-d</span>
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>Pulling cadvisor (google/cadvisor:latest)...
latest: Pulling from google/cadvisor
511136ea3c5a: Pull complete
46e263e5de56: Pull complete
cf677a5f718c: Pull complete
...
Creating cadvisor...
Creating editor2...
Creating editor1...
Creating es2...
Creating es1...
Creating logstash...
Creating logspout...
Creating portal2...
Creating kibana...
Creating portal1...
Creating balanceador...
</code></pre><p>Caso a seguinte mensagem seja exibida:</p>
<pre><code>Cannot start container faf8df3b73d4ddbfad550942020413e98ae8dd3bf84dc19b2b880273e261e5f2: Cannot link to a non running container: /logspout AS /balanceador/logspou
</code></pre><p>Ocorreu um problema na inicializa&#xE7;&#xE3;o do Logspout (que precisa do Logstash rodando para concluir com sucesso), devido &#xE0; ordem com que os servi&#xE7;os iniciam no Docker-Compose. Este problema pode ser resolvido aguardando por volta de 1 minuto (ou tempo suficiente para o Logstash inicializar completamente) e rodando <code>docker-compose up -d</code> novamente.</p>
<ul>
<li>Verifique que os cont&#xEA;ineres est&#xE3;o executando corretamente:</li>
</ul>
<pre><code class="lang-bash">docker-compose ps
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>   Name                  Command               State                                 Ports                                
-------------------------------------------------------------------------------------------------------------------------
balanceador   haproxy -f /usr/local/etc/ ...   Up      0.0.0.0:5601-&gt;5601/tcp, 0.0.0.0:80-&gt;80/tcp, 0.0.0.0:8080-&gt;8080/tcp 
cadvisor      /usr/bin/cadvisor                Up      8080/tcp                                                           
editor1       /bin/sh -c sh /run.sh            Up      8090/tcp                                                           
editor2       /bin/sh -c sh /run.sh            Up      8090/tcp                                                           
es1           /docker-entrypoint.sh elas ...   Up      9200/tcp, 9300/tcp                                                 
es2           /docker-entrypoint.sh elas ...   Up      9200/tcp, 9300/tcp                                                 
kibana        /docker-entrypoint.sh kibana     Up      5601/tcp                                                           
logspout      /bin/logspout                    Up      80/tcp, 8000/tcp                                                   
logstash      /docker-entrypoint.sh logs ...   Up      5000/tcp                                                           
portal1       /bin/sh -c sh /run.sh            Up      8080/tcp                                                           
portal2       /bin/sh -c sh /run.sh            Up      8080/tcp
</code></pre><ul>
<li>Verifique que a vers&#xE3;o do Portal de Servi&#xE7;os &#xE9; a desejada:</li>
</ul>
<pre><code class="lang-bash">curl -k https://localhost/info
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;1529&quot;</span>,
  <span class="hljs-string">&quot;time&quot;</span>: <span class="hljs-string">&quot;2015-08-28 00:43&quot;</span>,
  <span class="hljs-string">&quot;git&quot;</span>: {
    <span class="hljs-string">&quot;branch&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,
    <span class="hljs-string">&quot;commit&quot;</span>: {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;e5e9f74&quot;</span>,
      <span class="hljs-string">&quot;time&quot;</span>: <span class="hljs-string">&quot;2015-08-28 00:37&quot;</span>
    }
  }
}
</code></pre>
<ul>
<li>Verifique que a vers&#xE3;o do Editor de Servi&#xE7;os &#xE9; a desejada:</li>
</ul>
<pre><code class="lang-bash">curl -k https://localhost/editar/info
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;627&quot;</span>,
  <span class="hljs-string">&quot;time&quot;</span>: <span class="hljs-string">&quot;2015-08-28 00:42&quot;</span>,
  <span class="hljs-string">&quot;git&quot;</span>: {
    <span class="hljs-string">&quot;branch&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,
    <span class="hljs-string">&quot;commit&quot;</span>: {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;4b85c92&quot;</span>,
      <span class="hljs-string">&quot;time&quot;</span>: <span class="hljs-string">&quot;2015-08-28 00:39&quot;</span>
    }
  }
}
</code></pre>
<ul>
<li>Verificar que a sa&#xFA;de do cluster est&#xE1; <code>UP</code>:</li>
</ul>
<pre><code class="lang-bash">curl -k https://localhost/health
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
  <span class="hljs-string">&quot;portalDeServicosIndex&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
    <span class="hljs-string">&quot;portal-de-servicos&quot;</span>: <span class="hljs-string">&quot;ok (622 docs)&quot;</span>
  },
  <span class="hljs-string">&quot;elasticSearch&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;GREEN&quot;</span>,
    <span class="hljs-string">&quot;nodes&quot;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&quot;node-0&quot;</span>: <span class="hljs-string">&quot;es1&quot;</span>,
    <span class="hljs-string">&quot;node-1&quot;</span>: <span class="hljs-string">&quot;logstash-d9ccaa4d20c4-1-11624&quot;</span>,
    <span class="hljs-string">&quot;node-2&quot;</span>: <span class="hljs-string">&quot;es2&quot;</span>
  },
  <span class="hljs-string">&quot;cache&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UNKNOWN&quot;</span>
  },
  <span class="hljs-string">&quot;diskSpace&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
    <span class="hljs-string">&quot;free&quot;</span>: <span class="hljs-number">17378258944</span>,
    <span class="hljs-string">&quot;threshold&quot;</span>: <span class="hljs-number">10485760</span>
  }
}
</code></pre>
<p>Caso alguma das verifica&#xE7;&#xF5;es n&#xE3;o tenha sucesso, voc&#xEA; pode verificar o log dos cont&#xEA;ineres utilizando o seguinte comando:</p>
<pre><code>docker-compose logs
</code></pre><p><strong>IMPORTANTE</strong></p>
<p>Devido a <a href="https://github.com/servicosgovbr/docker/issues/12" target="_blank">Issue #12</a> &#xE9; necess&#xE1;rio realizar na primeira atualiza&#xE7;&#xE3;o os seguintes comandos:</p>
<pre><code>docker-compose stop portal1
docker-compose kill portal1
docker rm -f portal1 (Neste comando ocorrer&#xE1; um erro de remo&#xE7;&#xE3;o do container, pode prosseguir com os outros comandos)
docker-compose up -d portal1

docker-compose stop portal2
docker-compose kill portal2
docker rm -f portal2 (Neste comando ocorrer&#xE1; um erro de remo&#xE7;&#xE3;o do container, pode prosseguir com os outros comandos)
docker-compose up -d portal2

docker-compose stop editor1
docker-compose kill editor1
docker rm -f editor1 (Neste comando ocorrer&#xE1; um erro de remo&#xE7;&#xE3;o do container, pode prosseguir com os outros comandos)
docker-compose up -d editor1

docker-compose stop editor2
docker-compose kill editor2
docker rm -f editor2 (Neste comando ocorrer&#xE1; um erro de remo&#xE7;&#xE3;o do container, pode prosseguir com os outros comandos)
docker-compose up -d editor2
</code></pre><p>A instala&#xE7;&#xE3;o est&#xE1; conclu&#xED;da.</p>
<h3 id="restaurando-o-reposit&#xF3;rio-local">Restaurando o Reposit&#xF3;rio Local</h3>
<p>Os passos dessa se&#xE7;&#xE3;o devem ser seguidos <strong>apenas</strong> se a m&#xE1;quina utilizada para implanta&#xE7;&#xE3;o j&#xE1; possui a configura&#xE7;&#xE3;o inicial e uma instala&#xE7;&#xE3;o pr&#xE9;via realizada.</p>
<ul>
<li>No reposit&#xF3;rio local <a href="https://github.com/servicosgovbr/docker" target="_blank">servicosgovbr/docker</a>, pare e remova os cont&#xEA;ineres:</li>
</ul>
<pre><code>docker stop $(docker ps -a -q)
docker kill $(docker ps -a -q)
</code></pre><ul>
<li>Reinicie o Docker:</li>
</ul>
<pre><code class="lang-bash">systemctl restart docker
</code></pre>
<ul>
<li><p>Remova o reposit&#xF3;rio local <a href="https://github.com/servicosgovbr/docker" target="_blank">servicosgovbr/docker</a></p>
</li>
<li><p>Clone o reposit&#xF3;rio <a href="https://github.com/servicosgovbr/docker" target="_blank">servicosgovbr/docker</a> no diret&#xF3;rio <code>/root</code>:</p>
</li>
</ul>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> /root
git <span class="hljs-built_in">clone</span> https://github.com/servicosgovbr/docker
</code></pre>
<ul>
<li><p>O certificado digital dever&#xE1; ser instalado novamente na pasta do <code>docker</code>, conforme instru&#xE7;&#xF5;es da se&#xE7;&#xE3;o &quot;Certificado Digital SSL&quot;</p>
</li>
<li><p>Construa e rode os cont&#xEA;ineres:</p>
</li>
</ul>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> /root/docker
./build-all <span class="hljs-comment"># caso prefira baixar as imagens do docker hub, omita este passo</span>
docker-compose up <span class="hljs-operator">-d</span>
</code></pre>
<h3 id="atualiza&#xE7;&#xF5;es-posteriores">Atualiza&#xE7;&#xF5;es posteriores</h3>
<p>Todos os comandos a seguir devem ser rodados como super-usu&#xE1;rio (root), e presumem uma m&#xE1;quina [CentOS] 7 64bit, que j&#xE1; tem os cont&#xEA;ineres <a href="http://www.docker.com" target="_blank">Docker</a> rodando.</p>
<ul>
<li>Atualize o reposit&#xF3;rio <a href="https://github.com/servicosgovbr/docker" target="_blank">servicosgovbr/docker</a> no diret&#xF3;rio <code>/root</code>:</li>
</ul>
<pre><code class="lang-bash"><span class="hljs-built_in">cd</span> /root
git pull
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>remote: Counting objects: 27, done.
remote: Compressing objects: 100% (17/17), done.
remote: Total 27 (delta 15), reused 22 (delta 10), pack-reused 0
Unpacking objects: 100% (27/27), done.
From github.com:servicosgovbr/docker
   1f736fb..f069a55  master     -&gt; origin/master
First, rewinding head to replay your work on top of it...
Fast-forwarded master to f069a5552fec4c8bc9226c7941bb89fe0420ed75.
</code></pre><ul>
<li>Parar os cont&#xEA;ineres:</li>
</ul>
<pre><code class="lang-bash">docker-compose stop
</code></pre>
<ul>
<li>Baixe as novas imagens:</li>
</ul>
<pre><code class="lang-bash">docker-compose pull
</code></pre>
<ul>
<li>Rode os cont&#xEA;ineres:</li>
</ul>
<pre><code class="lang-bash">docker-compose up <span class="hljs-operator">-d</span>
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>Creating cadvisor...
Creating editor2...
Creating editor1...
Creating es2...
Creating es1...
Creating logstash...
Creating logspout...
Creating portal2...
Creating kibana...
Creating portal1...
Creating balanceador...
</code></pre><ul>
<li>Verifique que os cont&#xEA;ineres est&#xE3;o executando corretamente:</li>
</ul>
<pre><code class="lang-bash">docker-compose ps
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>   Name                  Command               State                                 Ports                                
-------------------------------------------------------------------------------------------------------------------------
balanceador   haproxy -f /usr/local/etc/ ...   Up      0.0.0.0:5601-&gt;5601/tcp, 0.0.0.0:80-&gt;80/tcp, 0.0.0.0:8080-&gt;8080/tcp 
cadvisor      /usr/bin/cadvisor                Up      8080/tcp                                                           
editor1       /bin/sh -c sh /run.sh            Up      8090/tcp                                                           
editor2       /bin/sh -c sh /run.sh            Up      8090/tcp                                                           
es1           /docker-entrypoint.sh elas ...   Up      9200/tcp, 9300/tcp                                                 
es2           /docker-entrypoint.sh elas ...   Up      9200/tcp, 9300/tcp                                                 
kibana        /docker-entrypoint.sh kibana     Up      5601/tcp                                                           
logspout      /bin/logspout                    Up      80/tcp, 8000/tcp                                                   
logstash      /docker-entrypoint.sh logs ...   Up      5000/tcp                                                           
portal1       /bin/sh -c sh /run.sh            Up      8080/tcp                                                           
portal2       /bin/sh -c sh /run.sh            Up      8080/tcp
</code></pre><ul>
<li>Verifique que a vers&#xE3;o do Portal de Servi&#xE7;os &#xE9; a desejada:</li>
</ul>
<pre><code class="lang-bash">curl -k https://localhost/info
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;1529&quot;</span>,
  <span class="hljs-string">&quot;time&quot;</span>: <span class="hljs-string">&quot;2015-08-28 00:43&quot;</span>,
  <span class="hljs-string">&quot;git&quot;</span>: {
    <span class="hljs-string">&quot;branch&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,
    <span class="hljs-string">&quot;commit&quot;</span>: {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;e5e9f74&quot;</span>,
      <span class="hljs-string">&quot;time&quot;</span>: <span class="hljs-string">&quot;2015-08-28 00:37&quot;</span>
    }
  }
}
</code></pre>
<ul>
<li>Verifique que a vers&#xE3;o do Editor de Servi&#xE7;os &#xE9; a desejada:</li>
</ul>
<pre><code class="lang-bash">curl -k https://localhost/editar/info
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;627&quot;</span>,
  <span class="hljs-string">&quot;time&quot;</span>: <span class="hljs-string">&quot;2015-08-28 00:42&quot;</span>,
  <span class="hljs-string">&quot;git&quot;</span>: {
    <span class="hljs-string">&quot;branch&quot;</span>: <span class="hljs-string">&quot;master&quot;</span>,
    <span class="hljs-string">&quot;commit&quot;</span>: {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;4b85c92&quot;</span>,
      <span class="hljs-string">&quot;time&quot;</span>: <span class="hljs-string">&quot;2015-08-28 00:39&quot;</span>
    }
  }
}
</code></pre>
<ul>
<li>Verificar que a sa&#xFA;de do cluster est&#xE1; <code>UP</code>:</li>
</ul>
<pre><code class="lang-bash">curl -k https://localhost/health
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
  <span class="hljs-string">&quot;portalDeServicosIndex&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
    <span class="hljs-string">&quot;portal-de-servicos&quot;</span>: <span class="hljs-string">&quot;ok (622 docs)&quot;</span>
  },
  <span class="hljs-string">&quot;elasticSearch&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;GREEN&quot;</span>,
    <span class="hljs-string">&quot;nodes&quot;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&quot;node-0&quot;</span>: <span class="hljs-string">&quot;es1&quot;</span>,
    <span class="hljs-string">&quot;node-1&quot;</span>: <span class="hljs-string">&quot;logstash-d9ccaa4d20c4-1-11624&quot;</span>,
    <span class="hljs-string">&quot;node-2&quot;</span>: <span class="hljs-string">&quot;es2&quot;</span>
  },
  <span class="hljs-string">&quot;cache&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UNKNOWN&quot;</span>
  },
  <span class="hljs-string">&quot;diskSpace&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
    <span class="hljs-string">&quot;free&quot;</span>: <span class="hljs-number">17378258944</span>,
    <span class="hljs-string">&quot;threshold&quot;</span>: <span class="hljs-number">10485760</span>
  }
}
</code></pre>
<p>Caso alguma das verifica&#xE7;&#xF5;es n&#xE3;o tenha sucesso, voc&#xEA; pode verificar o log dos cont&#xEA;ineres utilizando o seguinte comando:</p>
<pre><code>docker-compose logs
</code></pre><p>A instala&#xE7;&#xE3;o est&#xE1; conclu&#xED;da.</p>
<p>Se a atualiza&#xE7;&#xE3;o n&#xE3;o for bem sucedida, o seguinte comando poder&#xE1; ser executado, no diret&#xF3;rio padr&#xE3;o do Docker, como solu&#xE7;&#xE3;o de contorno: 
<code>./scripts/volta_estado_inicial</code>.
Esse script ir&#xE1; apagar todos os cont&#xEA;ineres e imagens locais do Docker. Imagens contendo as &#xFA;ltimas vers&#xF5;es do ambiente ser&#xE3;o obtidas da Internet. Al&#xE9;m disso, o ambiente ser&#xE1; constru&#xED;do de maneira autom&#xE1;tica novamente.</p>
<p><strong>Lembrete:</strong> Antes de executar o comando acima, &#xE9; muito importante que um backup v&#xE1;lido dos usu&#xE1;rios e permiss&#xF5;es exista. Caso contr&#xE1;rio, todos os usu&#xE1;rios criados para aquele ambiente ser&#xE3;o perdidos. Maiores informa&#xE7;&#xF5;es sobre como proceder com a cria&#xE7;&#xE3;o de um backup podem ser encontradas na se&#xE7;&#xE3;o de Backup (Usu&#xE1;rios e Permiss&#xF5;es).</p>
<h3 id="atualiza&#xE7;&#xF5;es-em-ambientes-sem-integra&#xE7;&#xE3;o-cont&#xED;nua">Atualiza&#xE7;&#xF5;es em ambientes sem integra&#xE7;&#xE3;o cont&#xED;nua</h3>
<p>Para realizar uma atualiza&#xE7;&#xE3;o em ambientes hospedados em datacenters do governo, que n&#xE3;o possuem acesso ao Snap, os seguintes passos s&#xE3;o necess&#xE1;rios:</p>
<ol>
<li>Garantir que a configura&#xE7;&#xE3;o inicial do docker j&#xE1; foi realizada na m&#xE1;quina host, conforme se&#xE7;&#xE3;o inicial de implanta&#xE7;&#xE3;o</li>
<li>Acessar ambiente utilizando SSH:
<code>ssh &lt;usu&#xE1;rio&gt;@&lt;ip do servidor&gt;</code></li>
<li>Utilizar o usu&#xE1;rio root:
<code>sudo su</code></li>
<li>Ir para o diret&#xF3;rio do docker:
<code>cd /root/docker/</code></li>
<li>Executar script bash que atualiza as inst&#xE2;ncias do Portal de Servi&#xE7;os e do Editor de Servi&#xE7;os:
<code>./scripts/update_portal_container</code> e <code>./scripts/update_editor_container</code></li>
<li>Para verificar que as atualiza&#xE7;&#xF5;es est&#xE3;o sendo aplicadas corretamente, verificar os logs do Docker. Por exemplo: 
<code>docker logs -f editor1</code></li>
</ol>
<h3 id="problemas-conhecidos">Problemas conhecidos</h3>
<h4 id="altera&#xE7;&#xF5;es-na-rede-firewall-ou-iptables">Altera&#xE7;&#xF5;es na rede, firewall ou iptables</h4>
<p>O Docker necessita ser reiniciado quando uma mudan&#xE7;a estrutural ou de configura&#xE7;&#xE3;o de redes &#xE9; realizada na m&#xE1;quina host.</p>
<p>Presumindo uma m&#xE1;quina [CentOS] 7 64bit, que j&#xE1; possui os cont&#xEA;ineres <a href="http://www.docker.com" target="_blank">Docker</a> rodando, recomendamos que os seguintes comandos sejam executados:</p>
<ul>
<li>No reposit&#xF3;rio local <a href="https://github.com/servicosgovbr/docker" target="_blank">servicosgovbr/docker</a>, pare e remova os cont&#xEA;ineres:</li>
</ul>
<pre><code class="lang-bash">docker stop $(docker ps <span class="hljs-operator">-a</span> -q)
docker <span class="hljs-built_in">kill</span> $(docker ps <span class="hljs-operator">-a</span> -q)
</code></pre>
<ul>
<li>Reinicie o Docker:</li>
</ul>
<pre><code class="lang-bash">systemctl restart docker
</code></pre>
<ul>
<li>Inicie os cont&#xEA;ineres novamente:</li>
</ul>
<pre><code class="lang-bash">docker-compose up <span class="hljs-operator">-d</span>
</code></pre>
<p>O comando acima deve produzir sa&#xED;da similar &#xE0; seguinte:</p>
<pre><code>Creating cadvisor...
Creating editor2...
Creating editor1...
Creating es2...
Creating es1...
Creating logstash...
Creating logspout...
Creating portal2...
Creating kibana...
Creating portal1...
Creating balanceador...
</code></pre><p><strong>Lembrete:</strong> Antes de executar os passos descritos acima, &#xE9; muito importante que um backup v&#xE1;lido dos usu&#xE1;rios e permiss&#xF5;es exista. Caso contr&#xE1;rio, todos os usu&#xE1;rios criados para aquele ambiente ser&#xE3;o perdidos. Maiores informa&#xE7;&#xF5;es sobre como proceder com a cria&#xE7;&#xE3;o de um backup podem ser encontradas na se&#xE7;&#xE3;o de Backup (Usu&#xE1;rios e Permiss&#xF5;es).</p>
<hr>
<h1 id="backups">Backups</h1>
<p>Backups devem ser feitos dos seguintes caminhos:</p>
<table>
<thead>
<tr>
<th>Caminho</th>
<th>Incremental?</th>
</tr>
</thead>
<tbody>
<tr>
<td>/root/.ssh</td>
<td>N&#xE3;o</td>
</tr>
<tr>
<td>/usr/share/elasticsearch/es1/data</td>
<td>Sim</td>
</tr>
<tr>
<td>/usr/share/elasticsearch/es2/data</td>
<td>Sim</td>
</tr>
<tr>
<td>/var/log/<em>*/</em></td>
<td>Sim</td>
</tr>
</tbody>
</table>
<p>A reten&#xE7;&#xE3;o dos mesmos pode variar dependendo do ambiente. Recomenda-se ao menos 30 dias.</p>
<h2 id="usu&#xE1;rios-e-permiss&#xF5;es">Usu&#xE1;rios e Permiss&#xF5;es</h2>
<p>Para efetuar o backup  dos dados do banco de dados que d&#xE1; suporte &#xE0; aplica&#xE7;&#xE3;o, contidos no cont&#xEA;iner dbdata, &#xE9; necess&#xE1;rio realizar os seguintes passos:</p>
<ol>
<li>Criar novo cont&#xEA;iner docker que se conecta com a pasta <code>/dbdata</code> onde est&#xE1; localizado os dados do banco</li>
<li>Esse cont&#xEA;iner deve ter uma pasta <code>/backup</code> compartilhada com o sistema</li>
<li>Executar comando para comprimir a pasta <code>/dbdata</code> na pasta <code>/backup</code>:<pre><code>docker run --volumes-from dbdata -v $(pwd):/backup ubuntu bash -c &quot;tar czvf /backup/backup-$(date &apos;+%d_%m_%y_%H_%M&apos;).tar.gz /dbdata&quot;
</code></pre></li>
</ol>
<p>Para recuperar os dados a partir de um backup:</p>
<ol>
<li>Pare a execu&#xE7;&#xE3;o dos cont&#xEA;ineres no host do Docker
<code>cd ~/docker/</code> e <code>docker-compose stop</code></li>
<li>Execute o data volume cont&#xEA;iner dbdata com o arquivo backup.tar descomprimido:<pre><code>docker run --volumes-from dbdata -v $(pwd):/backup ubuntu bash -c &quot;rm -rf /dbdata/* &amp;&amp; cd /tmp &amp;&amp; tar xzvf /backup/backup-22_12_15_07_51.tar.gz &amp;&amp; mv dbdata/* ../dbdata/&quot;
</code></pre></li>
<li>Ligue novamente os cont&#xEA;ineres:<br><code>docker-compose up</code></li>
</ol>
<p>Recomenda-se que o backup dos dados dos usu&#xE1;rios seja efetuado diariamente por uma rotina autom&#xE1;tica. Considerando que o volume de dados armazenados ser&#xE1; pequeno, o armazenamento di&#xE1;rio n&#xE3;o dever&#xE1; ser um problema. Al&#xE9;m disso, recomenda-se que os backups mais antigos que sete dias sejam descartados automaticamente. Essa rotina de dele&#xE7;&#xE3;o autom&#xE1;tica dever&#xE1; ser executada somente se backups dos &#xFA;ltimos sete dias existirem de fato.</p>
<p><strong>Aten&#xE7;&#xE3;o</strong>: recomenda-se  que o backup seja armazenado em um volume externo da m&#xE1;quina host do Docker.</p>
<hr>
<h1 id="monitoramento">Monitoramento</h1>
<p>A monitora&#xE7;&#xE3;o da sa&#xFA;de do host &#xE9; feita de maneira externa, utilizando Nagios. Para o monitoramento das inst&#xE2;ncias da aplica&#xE7;&#xE3;o e <a href="../desenvolvimento/elasticsearch.html">ElasticSearch</a>, com informa&#xE7;&#xF5;es mais detalhadas, as seguintes op&#xE7;&#xF5;es est&#xE3;o dispon&#xED;veis:</p>
<h2 id="balanceador-de-carga">Balanceador de Carga</h2>
<p>As estat&#xED;sticas do HAProxy ficam dispon&#xED;veis atrav&#xE9;s da porta de administra&#xE7;&#xE3;o (8080/tcp), no endere&#xE7;o <code>/lb-stats</code>. Por exemplo, em produ&#xE7;&#xE3;o, estas est&#xE3;o dispon&#xED;veis em <code>http://servicos.gov.br:8080/lb-stats</code>.</p>
<p>Nesta p&#xE1;gina est&#xE3;o contidas algumas estat&#xED;sticas de acesso, em n&#xFA;meros de I/O brutos, bem como de disponibilidade dos servi&#xE7;os gerenciados.</p>
<h2 id="portal-de-servi&#xE7;os">Portal de Servi&#xE7;os</h2>
<p>O Portal de Servi&#xE7;os disponibiliza informa&#xE7;&#xF5;es de sa&#xFA;de atrav&#xE9;s do endere&#xE7;o <code>/health</code>, que retorna JSON similar ao seguinte:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
  <span class="hljs-string">&quot;portalDeServicosIndex&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
    <span class="hljs-string">&quot;portal-de-servicos&quot;</span>: <span class="hljs-string">&quot;ok (622 docs)&quot;</span>
  },
  <span class="hljs-string">&quot;elasticSearch&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;GREEN&quot;</span>,
    <span class="hljs-string">&quot;nodes&quot;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-string">&quot;node-0&quot;</span>: <span class="hljs-string">&quot;es1&quot;</span>,
    <span class="hljs-string">&quot;node-1&quot;</span>: <span class="hljs-string">&quot;logstash-d9ccaa4d20c4-1-11624&quot;</span>,
    <span class="hljs-string">&quot;node-2&quot;</span>: <span class="hljs-string">&quot;es2&quot;</span>
  },
  <span class="hljs-string">&quot;cache&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UNKNOWN&quot;</span>
  },
  <span class="hljs-string">&quot;diskSpace&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
    <span class="hljs-string">&quot;free&quot;</span>: <span class="hljs-number">17378258944</span>,
    <span class="hljs-string">&quot;threshold&quot;</span>: <span class="hljs-number">10485760</span>
  }
}
</code></pre>
<p>Nele, &#xE9; poss&#xED;vel ver o estado geral da aplica&#xE7;&#xE3;o (<code>status</code>), do &#xED;ndice no ElasticSearch (<code>portalDeServicosIndex</code>), informa&#xE7;&#xF5;es de conex&#xE3;o ao ElasticSearch (<code>elasticsearch</code>), do estado do cache interno de p&#xE1;ginas (<code>cache</code>) e espa&#xE7;o em disco (<code>diskSpace</code>).</p>
<h2 id="editor-de-servi&#xE7;os">Editor de Servi&#xE7;os</h2>
<p>O Editor de Servi&#xE7;os disponibiliza informa&#xE7;&#xF5;es de sa&#xFA;de atrav&#xE9;s do endere&#xE7;o <code>/editar/health</code>, que retorna JSON similar ao seguinte:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
  <span class="hljs-string">&quot;diskSpace&quot;</span>: {
    <span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;UP&quot;</span>,
    <span class="hljs-string">&quot;free&quot;</span>: <span class="hljs-number">17378254848</span>,
    <span class="hljs-string">&quot;threshold&quot;</span>: <span class="hljs-number">10485760</span>
  }
}
</code></pre>
<p>Nele, &#xE9; poss&#xED;vel ver o estado geral da aplica&#xE7;&#xE3;o (<code>status</code>) e do espa&#xE7;o em disco (<code>diskSpace</code>).</p>
<h2 id="kibana">Kibana</h2>
<p>Todos os logs gerados pelas aplica&#xE7;&#xF5;es s&#xE3;o redirecionados para o <a href="../desenvolvimento/elasticsearch.html">ElasticSearch</a> atrav&#xE9;s do <a href="https://www.elastic.co/products/logstash" target="_blank">Logstash</a>. Eles s&#xE3;o indexados e podem ser auditados, buscados e visualizados atrav&#xE9;s do <a href="https://www.elastic.co/products/kibana" target="_blank">Kibana</a>, que fica dispon&#xED;vel na porta 5601/tcp. Por exemplo, em produ&#xE7;&#xE3;o, a ferramenta est&#xE1; dispon&#xED;vel em <code>http://servicos.gov.br:5601/</code>.</p>
<hr>
<h1 id="escalabilidade">Escalabilidade</h1>
<p>&#xC9; poss&#xED;vel aumentar a capacidade de carga do sistema de duas maneiras:</p>
<h2 id="aumentando-a-capacidade-do-servidor-vertical">Aumentando a capacidade do servidor (vertical)</h2>
<p>Servidores est&#xE3;o atualmente provisionados de acordo com a se&#xE7;&#xE3;o &quot;<a href="../desenvolvimento/implantacao-e-execucao.html">Implanta&#xE7;&#xE3;o e execu&#xE7;&#xE3;o</a>&quot;. Para adicionar mais capacidade, &#xE9; necess&#xE1;rio revisar as configura&#xE7;&#xF5;es pertinentes e analisar a performance total novamente (ver: &quot;<a href="../desenvolvimento/performance.html">Performance</a>&quot;).</p>
<h2 id="aumentando-a-quantidade-de-servidores-horizontal">Aumentando a quantidade de servidores (horizontal)</h2>
<p>Para adicionar um servidor de aplica&#xE7;&#xE3;o, ser&#xE1; necess&#xE1;rio:</p>
<ul>
<li>Dar um novo IP externo ao host <a href="http://www.docker.com" target="_blank">Docker</a></li>
<li>Criar um balanceador de carga com o IP externo anterior (ao qual o servicos.gov.br aponta)</li>
<li>Configurar o balanceador de carga criado para redirecionar tr&#xE1;fego ao host <a href="http://www.docker.com" target="_blank">Docker</a></li>
<li>Criar novas inst&#xE2;ncias do host <a href="http://www.docker.com" target="_blank">Docker</a>, id&#xEA;nticas, conforme necess&#xE1;rio</li>
<li>Adicion&#xE1;-las ao balanceador de carga criado no passos anteriores</li>
</ul>
<p>Ao fim destes passos, a arquitetura dever&#xE1; seguir o diagrama abaixo:</p>
<p><img src="../desenvolvimento/ambiente-docker-escalado.png" alt="Diagrama de ambiente com dois hosts"></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../implantacao/index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Implantação"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
